<!DOCTYPE html>
<html>
    <head>
       <style>
             canvas {
                border:1px solid #000000;
                background-color: #000000;
            }
        </style>
    </head>
    <body onload="startGame()">
        <script>
            var myGamePiece;
            var myObstacles = [];
            var myScore;
            function ballance(){
                var v =localStorage['airdox-wall'];
                return v;
            }
            function addBallance(v){
                localStorage['airdox-wall']=v;
            }
          
             function  redeem(amount){
         
                    receive(amount);
                 var w = document.getElementById("myWal");
                 w.innerHTML ="$ "+ ballance();
             }
              function receive(amount){
                    addBallance(amount.toFixed(8));
              }
             function startGame() {
                myGamePiece=new component(30,30,"#aa4400",10,120);
                myGamePiece.gravity=0;
                myScore=new component("20px","Consolas","#00af00",280,40,"text");
                myGameArea.start();
            }
            var myGameArea={
                canvas:document.createElement("canvas"),
                start:function(){
                    this.canvas.width=1000;//480;
                    this.canvas.height=400;
                    this.context=this.canvas.getContext("2d");
                    document.body.insertBefore(this.canvas,document.body.childNodes[0]);
                    this.frameNo=0;
                    this.interval=setInterval(updateGameArea,25);
                },
                clear:function(){
                    this.context.clearRect(0,0,this.canvas.width,this.canvas.height);
                }
            }
            function component(width,height,color,x,y,type){
                this.type=type;
                this.score=0;
                this.width=width;
                this.height=height;
                this.speedX=0;
                this.speedY=0;    
                this.x=x;
                this.y=y;
                this.gravity=0;
                this.gravitySpeed=0;
                this.update=function(){
                    ctx=myGameArea.context;
                    if(this.type=="text"){
                        ctx.font=this.width+" "+this.height;
                        ctx.fillStyle=color;
                        ctx.fillText(this.text,this.x,this.y);
                    }else if(this.type=="image"){
                        ctx.font=this.width+ " "+this.height;
                        ctx.fillStyle=color;
                        ctx.fillText(this.text,this.x,this.y);
                    }else{
                        ctx.fillStyle=color;
                        ctx.fillRect(this.x,this.y,this.width,this.height);
                    }
                }
                this.newPos=function(){
                    this.gravitySpeed+=this.gravity;
                    this.x+=this.speedX;
                    this.y+=this.speedY+this.gravitySpeed;
                    this.hitBottom();
                    this.hitTop();
                }
                this.hitTop=function(){
                    var rocktop=this.height;
                    if(this.y<rocktop){
                        this.y=rocktop;
                        this.gravitySpeed=0;
                    }
                }
                this.hitBottom=function(){
                    var rockbottom=myGameArea.canvas.height-this.height;
                    if(this.y>rockbottom){
                        this.y=rockbottom;
                        this.gravitySpeed=0;
                    }
                }
                this.crashWith=function(otherobj){
                    var myleft=this.x;
                    var myright=this.x+(this.width);
                    var mytop=this.y;
                    var mybottom=this.y+(this.height);
                    var otherleft=otherobj.x;
                    var otherright=otherobj.x+(otherobj.width);
                    var othertop=otherobj.y;
                    var otherbottom=otherobj.y+(otherobj.height);
                    var crash=true;
                    if((mybottom<othertop)||(mytop>otherbottom)||(myright<otherleft)||(myleft>otherright)){crash=false;}
                    return crash;
                }
            }
            function updateGameArea(){
                var x,height,gap,minHeight,maxHeight,minGap,maxGap;
                for(i=0;i<myObstacles.length;i+=1){
                    if(myGamePiece.crashWith(myObstacles[i])){return;}
                }
                myGameArea.clear();
                myGameArea.frameNo+=1;
                if(myGameArea.frameNo==1||everyinterval(150)){
                    x=myGameArea.canvas.width;
                    minHeight=20;
                    maxHeight=200;
                    height=Math.floor(Math.random()*(maxHeight-minHeight+1)+minHeight);
                    minGap=50;
                    maxGap=200;
                    gap=Math.floor(Math.random()*(maxGap-minGap+1)+minGap);
                    myObstacles.push(new component(10,height,"red",x,0));
                    myObstacles.push(new component(10,x-height-gap,"green",x,height+gap));
                }
                for(i=0;i<myObstacles.length;i+=1){
                    myObstacles[i].x+=-1;
                    myObstacles[i].update();
                }
                myScore.text="$"+(myGameArea.frameNo/1000).toFixed(8);
                myScore.amount=(myGameArea.frameNo/1000).toFixed(8);
                myScore.update();
                myGamePiece.newPos();
                myGamePiece.update();
            }
            function everyinterval(n){
                if((myGameArea.frameNo/n)%1==0){
                    return true;
                }
                return false;
            }
            function accelerate(n){
                myGamePiece.gravity=n;
            }
        </script>
        <hr>
  <button onkeydown="accelerate(-0.2)"onkeyup="accelerate(0.05)">Jump</button>
        <button onclick="accelerate(0.05)">Raise</button>
        <button onclick="accelerate(-0.2)">Fall</button>
        <button onclick="redeem(myScore.amount);">Redeem Rewards</button>
        <button onclick="window.location=window.location"id="replay">Replay</button>
        <h3 id="myWal">$0.00</h3>
    </body>
</html>
